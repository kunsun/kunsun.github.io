<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/66f30814ff6d7cdf.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/92f44bb82993d879-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/e11418ac562b8ac1-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/e3c2fb5352ee446e.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-27501c456ff6145b.js"/><script src="/_next/static/chunks/67cfe1a8-fc7c44b8310eda83.js" async=""></script><script src="/_next/static/chunks/221-f8b7d4d7cf39d2b0.js" async=""></script><script src="/_next/static/chunks/main-app-36c4b43897480e26.js" async=""></script><script src="/_next/static/chunks/177-274c75a00d0077d0.js" async=""></script><script src="/_next/static/chunks/856-c536f539c242b197.js" async=""></script><script src="/_next/static/chunks/app/layout-b234c99f4218b945.js" async=""></script><link rel="icon" href="/favicon.ico" sizes="any"/><title>kunsun.me</title><meta name="description" content="Generated by create next app"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="__variable_c1e5c9 __variable_3a0388"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="bg-color border-neutral-100 dark:border-neutral-900 h-max  relative flex justify-between items-center mx-2 px-2 md:px-3 h-[60px]"><a class="font-sans inline-block text-2xl font-black scale-100 active:scale-100" style="opacity:1;transition:transform 0.2s ease-in-out, opacity 0.2s 0.4s linear" href="/"><div class="mt-3 flex items-center max-w-2xl"><img alt="" loading="lazy" width="28" height="28" decoding="async" data-nimg="1" style="color:transparent" src="/logo_2.png"/><div class="text-[16px] ml-[4px] font-mono">kunsun</div></div></a></div><main class="flex max-w-2xl w-2xl mx-auto bg-gradient"><article class="font-mono"><h1>Webpack</h1><div class="text-[14px] text-tertiary mt-1">2021-02-02</div><div class="markdown markdown-body mt-10"><h2>Loader</h2>
<p class="text-[14px] text-neutral-100 dark:text-neutral-800 ">定义：loader 只是一个 Javascript 模块，此函数导出为函数</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1E1E1E;color:#D4D4D4" tabindex="0" data-language="js" data-theme="dark-plus"><code class="text-sm p-1"><span data-line=""><span style="color:#4EC9B0">module</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">exports</span><span style="color:#D4D4D4"> = </span><span style="color:#569CD6">function</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">source</span><span style="color:#D4D4D4">) {</span></span>
<span data-line=""><span style="color:#C586C0">  return</span><span style="color:#9CDCFE"> source</span></span>
<span data-line=""><span style="color:#D4D4D4">}</span></span></code></pre></figure>
<p class="text-[14px] text-neutral-100 dark:text-neutral-800 ">多个 loader 串行执行，从后到前执行，类似 Compose</p>
<h2>webpack 打包结果分析</h2>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1E1E1E;color:#D4D4D4" tabindex="0" data-language="js" data-theme="dark-plus"><code class="text-sm p-1"><span data-line=""><span style="color:#D4D4D4">;(</span><span style="color:#569CD6">function</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">modules</span><span style="color:#D4D4D4">) {</span></span>
<span data-line=""><span style="color:#6A9955">  // ...</span></span>
<span data-line=""><span style="color:#D4D4D4">})({</span></span>
<span data-line=""><span style="color:#CE9178">  &quot;./src/hello.js&quot;</span><span style="color:#9CDCFE">:</span><span style="color:#569CD6"> function</span><span style="color:#D4D4D4"> () {</span></span>
<span data-line=""><span style="color:#6A9955">    // ...</span></span>
<span data-line=""><span style="color:#D4D4D4">  },</span></span>
<span data-line=""><span style="color:#CE9178">  &quot;./src/index.js&quot;</span><span style="color:#9CDCFE">:</span><span style="color:#569CD6"> function</span><span style="color:#D4D4D4"> () {</span></span>
<span data-line=""><span style="color:#6A9955">    // ...</span></span>
<span data-line=""><span style="color:#D4D4D4">  },</span></span>
<span data-line=""><span style="color:#D4D4D4">})</span></span></code></pre></figure>
<ol>
<li>打包结果就是一个 IIFE，称之为 webpackBootstrap，参数是 modules：modules 对象的 key 是依赖路径，value 是经过简单处理后的脚本</li>
<li>打包结果中，定义了一个重要的模块加载函数 <strong>webpack_require</strong></li>
<li>我们首先使用 <strong>webpack_require</strong> 加载函数去加载入口模块 ./src/index.js</li>
<li>加载函数  <strong>webpack_require</strong> 使用了闭包变量 installedModules，它的作用是将已加载过的模块结果保存在内存中。</li>
</ol>
<h2>webpack 工作的基本原理</h2>
<ol>
<li>配置读取：读取 webpack.config.js 的配置、或者命令行</li>
<li>实例化所需的 webpack 插件，在 webpack 时间流上挂载钩子，这样在合适的构建过程中，插件具备了改动产出结果的能力</li>
<li>以入口文件为开始，进行依赖收集； 通过 loader 对依赖文件进行编译；编译好之后生成 AST 抽象语法树；分析文件依赖关系，将不同模块化语法替换为<strong>webpack_require</strong>,使用自己的加载器进行模块化实现</li>
<li>产出结果，依据开发者的配置，将结果打包到目录下</li>
</ol>
<p class="text-[14px] text-neutral-100 dark:text-neutral-800 ">webpack 和插件采用基于事件流的发布订阅模式，监听某些关键过程，在这些环节中执行插件任务。</p>
<h2>执行步骤：</h2>
<ol>
<li>加载 loaded</li>
<li>封存 sealed</li>
<li>优化 optimized</li>
<li>分块 chunked</li>
<li>哈希 hashed</li>
<li>重新创建 restored</li>
</ol>
<h2>抽象语法树 AST</h2>
<p class="text-[14px] text-neutral-100 dark:text-neutral-800 ">可以用 obj 表示，分析代码的依赖关系</p>
<h2>compiler 和 compilation</h2>
<p class="text-[14px] text-neutral-100 dark:text-neutral-800 ">webpack 的构建过程是通过 compiler 控制流程，compilation 进行解析。在开发插件时，我们可以从 compiler 对象中拿到所有和 webpack 主环境相关的内容，包括事件钩子。</p>
<p class="text-[14px] text-neutral-100 dark:text-neutral-800 ">compiler 对象和 compilation 对象都继承自 tapable，tapable.js 这个库暴露了所有和事件相关的 pub/sub 的方法。</p>
<h3>compiler 对象</h3>
<p class="text-[14px] text-neutral-100 dark:text-neutral-800 ">webpack 的骨架，或中枢神经。
它的实例包含了完整的 webpack 配置，全局只有一个 compiler 实例，
暴露了很多钩子 Hooks：</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1E1E1E;color:#D4D4D4" tabindex="0" data-language="js" data-theme="dark-plus"><code class="text-sm p-1"><span data-line=""><span style="color:#6A9955">//基本写法</span></span>
<span data-line=""><span style="color:#9CDCFE">compiler</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">hooks</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">someHook</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">tap</span><span style="color:#D4D4D4">(...)</span></span>
<span data-line=""><span style="color:#6A9955">// 读取entry配置完成后</span></span>
<span data-line=""><span style="color:#9CDCFE">compiler</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">hooks</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">entryOption</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">tap</span><span style="color:#D4D4D4">(...)</span></span>
<span data-line=""><span style="color:#6A9955">// 资源输出之前</span></span>
<span data-line=""><span style="color:#9CDCFE">compiler</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">hooks</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">emit</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">tap</span><span style="color:#D4D4D4">(...)</span></span></code></pre></figure>
<h3>compilation 对象</h3>
<p class="text-[14px] text-neutral-100 dark:text-neutral-800 ">当 webpack 以开发模式运行时，每当检测到文件变化，一个新的 compilation 对象将被创建。这个对象包含了当前的模块资源、编译生成资源、变化的文件等信息。也就是说，所有构建过程中产生的构建数据都存储在该对象上，它也掌控着构建过程中的每一个环节。该对象也提供了很多事件回调供插件做扩展。
compilation 也暴露了与模块和依赖有关的粒度更小的钩子:</p>
<h2>Loader</h2>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1E1E1E;color:#D4D4D4" tabindex="0" data-language="js" data-theme="dark-plus"><code class="text-sm p-1"><span data-line=""><span style="color:#4EC9B0">module</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">exports</span><span style="color:#D4D4D4"> = </span><span style="color:#569CD6">function</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">source</span><span style="color:#D4D4D4">) {</span></span>
<span data-line=""><span style="color:#6A9955">  // 获取开发者配置的 options</span></span>
<span data-line=""><span style="color:#569CD6">  const</span><span style="color:#4FC1FF"> options</span><span style="color:#D4D4D4"> = </span><span style="color:#9CDCFE">loaderUtils</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">getOptions</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">this</span><span style="color:#D4D4D4">)</span></span>
<span data-line=""><span style="color:#6A9955">  // some magic...</span></span>
<span data-line=""><span style="color:#6A9955">  // return content</span></span>
<span data-line=""><span style="color:#569CD6">  this</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">callback</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">null</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">content</span><span style="color:#D4D4D4">)</span></span>
<span data-line=""><span style="color:#D4D4D4">}</span></span></code></pre></figure>
<h2>Plugin</h2>
<p class="text-[14px] text-neutral-100 dark:text-neutral-800 ">我们反复提到过 webpack 事件流机制，也就是说在 webpack 构建的生命周期中，会广播许多事件。
loader 和 plugin 的差异：</p>
<ol>
<li>loader 其实就是一个转换器，执行单纯的文件转换操作。</li>
<li>plugin 是一个扩展器，它丰富了 webpack 本身，在 loader 过程结束后，webpack 打包的整个过程中，weback plugin 并不直接操作文件，而是基于事件机制工作，监听 webpack 打包过程中的某些事件，见缝插针，修改打包结果。</li>
</ol>
<p class="text-[14px] text-neutral-100 dark:text-neutral-800 ">一个自定义 webpack plugin 的骨架结构就是一个带有 apply 方法的 class：</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1E1E1E;color:#D4D4D4" tabindex="0" data-language="js" data-theme="dark-plus"><code class="text-sm p-1"><span data-line=""><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> CustomPlugin</span><span style="color:#D4D4D4"> {</span></span>
<span data-line=""><span style="color:#569CD6">  constructor</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">options</span><span style="color:#D4D4D4">) {</span></span>
<span data-line=""><span style="color:#569CD6">    this</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">options</span><span style="color:#D4D4D4"> = </span><span style="color:#9CDCFE">options</span></span>
<span data-line=""><span style="color:#D4D4D4">  }</span></span>
<span data-line=""><span style="color:#DCDCAA">  apply</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">compiler</span><span style="color:#D4D4D4">) {</span></span>
<span data-line=""><span style="color:#6A9955">    // 相关钩子注册回调</span></span>
<span data-line=""><span style="color:#9CDCFE">    compiler</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">hooks</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">someHook</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">tap</span><span style="color:#D4D4D4">(</span><span style="color:#CE9178">&quot;CustomPlugin&quot;</span><span style="color:#D4D4D4">, () </span><span style="color:#569CD6">=&gt;</span><span style="color:#D4D4D4"> {</span></span>
<span data-line=""><span style="color:#6A9955">      // magic here...</span></span>
<span data-line=""><span style="color:#D4D4D4">    })</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A9955">    // 打印出此时 compiler 暴露的钩子</span></span>
<span data-line=""><span style="color:#C586C0">    for</span><span style="color:#D4D4D4"> (</span><span style="color:#569CD6">var</span><span style="color:#9CDCFE"> hook</span><span style="color:#569CD6"> of</span><span style="color:#9CDCFE"> Object</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">keys</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">compiler</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">hooks</span><span style="color:#D4D4D4">)) {</span></span>
<span data-line=""><span style="color:#9CDCFE">      console</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">log</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">hook</span><span style="color:#D4D4D4">)</span></span>
<span data-line=""><span style="color:#D4D4D4">    }</span></span>
<span data-line=""><span style="color:#D4D4D4">  }</span></span>
<span data-line=""><span style="color:#D4D4D4">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#4EC9B0">module</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">exports</span><span style="color:#D4D4D4"> = </span><span style="color:#9CDCFE">customPlugin</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#1E1E1E;color:#D4D4D4" tabindex="0" data-language="js" data-theme="dark-plus"><code class="text-sm p-1"><span data-line=""><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> CustomPlugin</span><span style="color:#D4D4D4"> {</span></span>
<span data-line=""><span style="color:#569CD6">  constructor</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">options</span><span style="color:#D4D4D4">) {</span></span>
<span data-line=""><span style="color:#569CD6">    this</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">options</span><span style="color:#D4D4D4"> = </span><span style="color:#9CDCFE">options</span></span>
<span data-line=""><span style="color:#D4D4D4">  }</span></span>
<span data-line=""><span style="color:#DCDCAA">  apply</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">compiler</span><span style="color:#D4D4D4">) {</span></span>
<span data-line=""><span style="color:#9CDCFE">    compiler</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">hooks</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">compilation</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">tap</span><span style="color:#D4D4D4">(</span></span>
<span data-line=""><span style="color:#CE9178">      &quot;CustomPlugin&quot;</span><span style="color:#D4D4D4">,</span></span>
<span data-line=""><span style="color:#569CD6">      function</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">compilation</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">callback</span><span style="color:#D4D4D4">) {</span></span>
<span data-line=""><span style="color:#9CDCFE">        compilation</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">hooks</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">someOtherHook</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">tap</span><span style="color:#D4D4D4">(</span><span style="color:#CE9178">&quot;SomePlugin&quot;</span><span style="color:#D4D4D4">, </span><span style="color:#569CD6">function</span><span style="color:#D4D4D4"> () {</span></span>
<span data-line=""><span style="color:#6A9955">          // some magic here</span></span>
<span data-line=""><span style="color:#D4D4D4">        })</span></span>
<span data-line=""><span style="color:#D4D4D4">      }</span></span>
<span data-line=""><span style="color:#D4D4D4">    )</span></span>
<span data-line=""><span style="color:#D4D4D4">  }</span></span>
<span data-line=""><span style="color:#D4D4D4">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#4EC9B0">module</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">exports</span><span style="color:#D4D4D4"> = </span><span style="color:#9CDCFE">customPlugin</span></span></code></pre></figure>
<p class="text-[14px] text-neutral-100 dark:text-neutral-800 ">实现 webpack plugin 的套路：</p>
<ol>
<li>定义一个 JavaScript class 函数，或在函数原型（prototype）中定义一个以 compiler 对象为参数的 apply 方法。</li>
<li>apply 函数中通过 compiler 插入指定的事件钩子，在钩子回调中拿到 compilation 对象。</li>
<li>使用 compilation 操纵修改 webapack 打包内容。</li>
</ol></div></article></main><script src="/_next/static/chunks/webpack-27501c456ff6145b.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/66f30814ff6d7cdf.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/92f44bb82993d879-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/media/e11418ac562b8ac1-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n5:HL[\"/_next/static/css/e3c2fb5352ee446e.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"6:I[3787,[],\"\"]\n9:I[3099,[],\"\"]\nb:I[2506,[],\"\"]\nc:I[3637,[\"177\",\"static/chunks/177-274c75a00d0077d0.js\",\"856\",\"static/chunks/856-c536f539c242b197.js\",\"185\",\"static/chunks/app/layout-b234c99f4218b945.js\"],\"ThemeProvider\"]\nd:I[2483,[\"177\",\"static/chunks/177-274c75a00d0077d0.js\",\"856\",\"static/chunks/856-c536f539c242b197.js\",\"185\",\"static/chunks/app/layout-b234c99f4218b945.js\"],\"default\"]\nf:I[4384,[],\"\"]\na:[\"slug\",\"webpack\",\"d\"]\n10:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e3c2fb5352ee446e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L6\",null,{\"buildId\":\"hml4PglGPcx3FGto1gUaT\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/webpack/\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"webpack\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"webpack\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"webpack\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L7\",\"$L8\"],null],null]},[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$a\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}],null]},[[\"$\",\"html\",null,{\"lang\":\"zh-CN\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"sizes\":\"any\"}],[\"$\",\"body\",null,{\"className\":\"__variable_c1e5c9 __variable_3a0388\",\"children\":[\"$\",\"$Lc\",null,{\"attribute\":\"class\",\"children\":[[\"$\",\"$Ld\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex max-w-2xl w-2xl mx-auto bg-gradient\",\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]]}]}]]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Le\"],\"globalErrorComponent\":\"$f\",\"missingSlots\":\"$W10\"}]]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"kunsun.me\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Generated by create next app\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"8:[\"$\",\"article\",null,{\"className\":\"font-mono\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"Webpack\"}],[\"$\",\"div\",null,{\"className\":\"text-[14px] text-tertiary mt-1\",\"children\":\"2021-02-02\"}],[\"$\",\"div\",null,{\"className\":\"markdown markdown-body mt-10\",\"children\":\"$L11\"}]]}]\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"h2\",null,{\"children\":\"Loader\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-[14px] text-neutral-100 dark:text-neutral-800 \",\"children\":\"定义：loader 只是一个 Javascript 模块，此函数导出为函数\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#1E1E1E\",\"color\":\"#D4D4D4\"},\"tabIndex\":\"0\",\"data-language\":\"js\",\"data-theme\":\"dark-plus\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-sm p-1\",\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#4EC9B0\"},\"children\":\"module\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#4EC9B0\"},\"children\":\"exports\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" = \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"source\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#C586C0\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\" source\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-[14px] text-neutral-100 dark:text-neutral-800 \",\"children\":\"多个 loader 串行执行，从后到前执行，类似 Compose\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"webpack 打包结果分析\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#1E1E1E\",\"color\":\"#D4D4D4\"},\"tabIndex\":\"0\",\"data-language\":\"js\",\"data-theme\":\"dark-plus\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-sm p-1\",\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\";(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"modules\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"  // ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"})({\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CE9178\"},\"children\":\"  \\\"./src/hello.js\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\" function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" () {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"    // ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"  },\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CE9178\"},\"children\":\"  \\\"./src/index.js\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\" function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" () {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"    // ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"  },\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"})\"}]}]]}]}]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"打包结果就是一个 IIFE，称之为 webpackBootstrap，参数是 modules：modules 对象的 key 是依赖路径，value 是经过简单处理后的脚本\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"打包结果中，定义了一个重要的模块加载函数 \",[\"$\",\"strong\",null,{\"children\":\"webpack_require\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"我们首先使用 \",[\"$\",\"strong\",null,{\"children\":\"webpack_require\"}],\" 加载函数去加载入口模块 ./src/index.js\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"加载函数 \\b \",[\"$\",\"strong\",null,{\"children\":\"webpack_require\"}],\" 使用了闭包变量 installedModules，它的作用是将已加载过的模块结果保存在内存中。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"webpack 工作的基本原理\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"配置读取：读取 webpack.config.js 的配置、或者命令行\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"实例化所需的 webpack 插件，在 webpack 时间流上挂载钩子，这样在合适的构建过程中，插件具备了改动产出结果的能力\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"以入口文件为开始，进行依赖收集； 通过 loader 对依赖文件进行编译；编译好之后生成 AST 抽象语法树；分析文件依赖关系，将不同模块化语法替换为\",[\"$\",\"strong\",null,{\"children\":\"webpack_require\"}],\",使用自己的加载器进行模块化实现\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"产出结果，依据开发者的配置，将结果打包到目录下\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-[14px] text-neutral-100 dark:text-neutral-800 \",\"children\":\"webpack 和插件采用基于事件流的发布订阅模式，监听某些关键过程，在这些环节中执行插件任务。\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"执行步骤：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"加载 loaded\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"封存 sealed\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"优化 optimized\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"分块 chunked\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"哈希 hashed\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"重新创建 restored\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"抽象语法树 AST\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-[14px] text-neutral-100 dark:text-neutral-800 \",\"children\":\"可以用 obj 表示，分析代码的依赖关系\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"compiler 和 compilation\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-[14px] text-neutral-100 dark:text-neutral-800 \",\"children\":\"webpack 的构建过程是通过 compiler 控制流程，compilation 进行解析。在开发插件时，我们可以从 compiler 对象中拿到所有和 webpack 主环境相关的内容，包括事件钩子。\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-[14px] text-neutral-100 dark:text-neutral-800 \",\"children\":\"compiler 对象和 compilation 对象都继承自 tapable，tapable.js 这个库暴露了所有和事件相关的 pub/sub 的方法。\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"compiler 对象\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-[14px] text-neutral-100 dark:text-neutral-800 \",\"children\":\"webpack 的骨架，或中枢神经。\\n它的实例包含了完整的 webpack 配置，全局只有一个 compiler 实例，\\n暴露了很多钩子 Hooks：\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#1E1E1E\",\"color\":\"#D4D4D4\"},\"tabIndex\":\"0\",\"data-language\":\"js\",\"data-theme\":\"dark-plus\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-sm p-1\",\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"//基本写法\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"compiler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"hooks\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"someHook\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"tap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(...)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"// 读取entry配置完成后\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"compiler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"hooks\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"entryOption\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"tap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(...)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"// 资源输出之前\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"compiler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"hooks\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"emit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"tap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(...)\"}]]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"compilation 对象\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-[14px] text-neutral-100 dark:text-neutral-800 \",\"children\":\"当 webpack 以开发模式运行时，每当检测到文件变化，一个新的 compilation 对象将被创建。这个对象包含了当前的模块资源、编译生成资源、变化的文件等信息。也就是说，所有构建过程中产生的构建数据都存储在该对象上，它也掌控着构建过程中的每一个环节。该对象也提供了很多事件回调供插件做扩展。\\ncompilation 也暴露了与模块和依赖有关的粒度更小的钩子:\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Loader\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#1E1E1E\",\"color\":\"#D4D4D4\"},\"tabIndex\":\"0\",\"data-language\":\"js\",\"data-theme\":\"dark-plus\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-sm p-1\",\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#4EC9B0\"},\"children\":\"module\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#4EC9B0\"},\"children\":\"exports\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" = \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"source\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"  // 获取开发者配置的 options\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"  const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#4FC1FF\"},\"children\":\" options\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" = \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"loaderUtils\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"getOptions\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"  // some magic...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"  // return content\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"  this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"callback\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"content\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Plugin\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-[14px] text-neutral-100 dark:text-neutral-800 \",\"children\":\"我们反复提到过 webpack 事件流机制，也就是说在 webpack 构建的生命周期中，会广播许多事件。\\nloader 和 plugin 的差异：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"loader 其实就是一个转换器，执行单纯的文件转换操作。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"plugin 是一个扩展器，它丰富了 webpack 本身，在 loader 过程结束后，webpack 打包的整个过程中，weback plugin 并不直接操作文件，而是基于事件机制工作，监听 webpack 打包过程中的某些事件，见缝插针，修改打包结果。\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-[14px] text-neutral-100 dark:text-neutral-800 \",\"children\":\"一个自定义 webpack plugin 的骨架结构就是一个带有 apply 方法的 class：\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#1E1E1E\",\"color\":\"#D4D4D4\"},\"tabIndex\":\"0\",\"data-language\":\"js\",\"data-theme\":\"dark-plus\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-sm p-1\",\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#4EC9B0\"},\"children\":\" CustomPlugin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"  constructor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"options\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"    this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"options\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" = \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"options\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"  apply\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"compiler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"    // 相关钩子注册回调\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"    compiler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"hooks\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"someHook\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"tap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CE9178\"},\"children\":\"\\\"CustomPlugin\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\", () \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"      // magic here...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"    })\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"    // 打印出此时 compiler 暴露的钩子\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#C586C0\"},\"children\":\"    for\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\" hook\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\" of\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\" Object\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"keys\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"compiler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"hooks\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\")) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"      console\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"log\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"hook\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#4EC9B0\"},\"children\":\"module\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#4EC9B0\"},\"children\":\"exports\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" = \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"customPlugin\"}]]}]]}]}]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#1E1E1E\",\"color\":\"#D4D4D4\"},\"tabIndex\":\"0\",\"data-language\":\"js\",\"data-theme\":\"dark-plus\",\"children\":[\"$\",\"code\",null,{\"className\":\"text-sm p-1\",\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#4EC9B0\"},\"children\":\" CustomPlugin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"  constructor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"options\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"    this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"options\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" = \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"options\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"  apply\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"compiler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"    compiler\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"hooks\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"compilation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"tap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#CE9178\"},\"children\":\"      \\\"CustomPlugin\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"      function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"compilation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"callback\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"        compilation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"hooks\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"someOtherHook\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCDCAA\"},\"children\":\"tap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#CE9178\"},\"children\":\"\\\"SomePlugin\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#569CD6\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" () {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A9955\"},\"children\":\"          // some magic here\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"        })\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"      }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"    )\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#4EC9B0\"},\"children\":\"module\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#4EC9B0\"},\"children\":\"exports\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D4D4D4\"},\"children\":\" = \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#9CDCFE\"},\"children\":\"customPlugin\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-[14px] text-neutral-100 dark:text-neutral-800 \",\"children\":\"实现 webpack plugin 的套路：\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"定义一个 JavaScript class 函数，或在函数原型（prototype）中定义一个以 compiler 对象为参数的 apply 方法。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"apply 函数中通过 compiler 插入指定的事件钩子，在钩子回调中拿到 compilation 对象。\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"使用 compilation 操纵修改 webapack 打包内容。\"}],\"\\n\"]}]]\n"])</script></body></html>