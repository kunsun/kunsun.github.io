3:I[9275,[],""]
5:I[1343,[],""]
6:I[9512,["291","static/chunks/291-6bbee38a07e9cada.js","185","static/chunks/app/layout-63fef89d60d429d4.js"],"ThemeProvider"]
7:I[8871,["291","static/chunks/291-6bbee38a07e9cada.js","185","static/chunks/app/layout-63fef89d60d429d4.js"],"default"]
4:["slug","%E7%BC%93%E5%AD%98","d"]
0:["pRzpiwg6pXJZjwfKMKBnX",[[["",{"children":["blog",{"children":[["slug","%E7%BC%93%E5%AD%98","d"],{"children":["__PAGE__?{\"slug\":\"缓存\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["slug","%E7%BC%93%E5%AD%98","d"],{"children":["__PAGE__",{},[["$L1","$L2"],null],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/cb67a214fed64752.css","precedence":"next","crossOrigin":"$undefined"}]]}],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}],null]},[["$","html",null,{"lang":"zh-CN","suppressHydrationWarning":true,"children":["$","body",null,{"className":"__variable_c1e5c9 __variable_3a0388","children":["$","$L6",null,{"attribute":"class","children":[["$","$L7",null,{}],["$","main",null,{"className":"flex max-w-2xl mx-auto bg-gradient","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":null}]}]]}]}]}],null],null],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/14d650bd7f8bf870.css","precedence":"next","crossOrigin":"$undefined"}]],"$L8"]]]]
8:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Create Next App"}],["$","meta","3",{"name":"description","content":"Generated by create next app"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","meta","5",{"name":"next-size-adjust"}]]
1:null
2:["$","main",null,{"className":"font-mono","children":[["$","h1",null,{"children":"Web 缓存"}],["$","div",null,{"className":"text-[14px] text-tertiary mt-1","children":"2021-02-02"}],["$","div",null,{"className":"markdown mt-10","children":"$L9"}]]}]
9:[["$","p",null,{"children":"说到底缓存最重要的核心就是解决："}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"什么时候使用缓存"}],"\n",["$","li",null,{"children":"什么时候更新缓存"}],"\n"]}],"\n",["$","h2",null,{"children":"强缓存"}],"\n",["$","h3",null,{"children":"HTTP1.1"}],"\n",["$","p",null,{"children":"服务端使用 Cache-control 这个响应头"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"private：表示私有缓存，不能被共有缓存代理服务器缓存，不能在用户间共享，可被用户的浏览器缓存。"}],"\n",["$","li",null,{"children":"public：表示共有缓存，可被代理服务器缓存，比如 CDN，允许多用户间共享"}],"\n",["$","li",null,{"children":"max-age：值以秒为单位，表示缓存的内容会在该值后过期"}],"\n",["$","li",null,{"children":"no-cache：需要使用协商缓存，协商缓存的内容我们后面介绍。注意这个字段并不表示不使用缓存"}],"\n",["$","li",null,{"children":"no-store：所有内容都不会被缓存"}],"\n"]}],"\n",["$","p",null,{"children":"HTTP 规定，如果 Cache-control 的 max-age 和 Expires 同时出现，那么 max-age 的优先级更高，他会默认覆盖掉 expires。"}],"\n",["$","h2",null,{"children":"协商缓存"}],"\n",["$","p",null,{"children":"从优化的角度来说，我们真正应该关心的是服务器端文件是否已经发生了变化。此时我们需要用到协商缓存策略。"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"Last-Modified，If-Modified-Since"}],"\n",["$","li",null,{"children":"ETag、If-None-Match"}],"\n"]}],"\n",["$","p",null,{"children":"分析第一种：\nLast-Modified 标注的最后修改只能精确到秒级"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"浏览器第一次请求资源，服务端在返回资源的响应头中加入 Last-Modified 字段，这个字段表示这个资源在服务器上的最近修改时间"}],"\n",["$","li",null,{"children":"浏览器收到响应，并记录 Last-Modified 这个响应头的值为 T"}],"\n",["$","li",null,{"children":"当浏览器再次向服务端请求该资源时，请求头加上 If-Modified-Since 的 header，这个 If-Modified-Since 的值正是上一次请求该资源时，后端返回的 Last-Modified 响应头值 T"}],"\n"]}],"\n",["$","p",null,{"children":"分析第二种：\n服务器集群来处理请求的网站来说， Etag 的匹配概率会大幅降低。所在在这种情况下，使用 Etag 来处理缓存，反而会有更大的开销。"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"浏览器第一次请求资源，服务端在返回资源的响应头中加入 Etag，Etag 能够弥补 Last-Modified 的问题，因为 Etag 的生成过程类似文件 hash 值，Etag 是一个字符串，不同文件内容对应不同的 Etag 值"}],"\n",["$","li",null,{"children":"浏览器收到响应，记录 Etag 这个响应头的值为 E"}],"\n",["$","li",null,{"children":"浏览器再次跟服务器请求这个资源时，在请求头上加上 If-None-Match，值为 Etag 这个响应头的值 E"}],"\n",["$","li",null,{"children":"服务端再次收到请求，根据请求头 If-None-Match 的值 E，根据资源生成一个新的 ETag，对比 E 和新的 Etag：如果两值相同，则说明资源没有变化，返回 304 Not Modified，同时携带着新的 ETag 响应头；如果两值不同，就正常返回资源内容，这时也更新 ETag 响应头"}],"\n",["$","li",null,{"children":"浏览器收到 304 的响应后，就会从缓存中加载资源"}],"\n"]}],"\n",["$","p",null,{"children":"优先级：\nCache-Control > Expires > ETag > Last-Modified"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"当用户 Ctrl + F5 强制刷新网页时，浏览器直接从服务器加载，跳过强缓存和协商缓存 相当于在 chrome 控制台打开 no-cache 选项"}],"\n",["$","li",null,{"children":"当用户仅仅敲击 F5 刷新网页时，跳过强缓存，但是仍然会进行协商缓存过程"}],"\n"]}],"\n",["$","h2",null,{"children":"1. 如何禁止浏览器不缓存静态资源"}],"\n",["$","p",null,{"children":"设置请求头："}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"Cache-Control: no-cache, no-store, must-revalidate\n"}]}],"\n",["$","p",null,{"children":"增加版本号："}],"\n",["$","p",null,{"children":"meta 标签"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-html","children":"<meta\n  http-equiv=\"Cache-Control\"\n  content=\"no-cache, no-store, must-revalidate\"\n/>\n"}]}],"\n",["$","h2",null,{"children":"2. 题目二：设置以下 request/response header 会有什么效果？"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"cache-control: max-age=0\n"}]}],"\n",["$","p",null,{"children":"因为 max-age 设置为 0，所以浏览器必须发请求重新验证资源。这时候会走协商缓存机制，可能返回 200 或者 304。"}],"\n",["$","h2",null,{"children":"3. 题目三：设置以下 request/response header 会有什么效果？"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"cache-control: no-cache\n"}]}],"\n",["$","p",null,{"children":"因为设置 no-cache，所以浏览器必须发请求重新验证资源。这时候会走协商缓存机制。"}],"\n",["$","h2",null,{"children":"4. 题目四：除了上述方式，还有哪种方式可以设置浏览器必须发请求重新验证资源，走协商缓存机制？"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"cache-control: must-revalidate\n"}]}],"\n",["$","h2",null,{"children":"5. 题目五：设置以下 request/response header 会有什么效果？"}],"\n",["$","pre",null,{"children":["$","code",null,{"className":"language-js","children":"Cache-Control: max-age=60, must-revalidate\n"}]}],"\n",["$","p",null,{"children":"如果资源在 60s 内再次访问，走强缓存，可以直接返回缓存资源内容；如果超过 60s，则必须发送网络请求到服务端，去验证资源的有效性。"}],"\n",["$","h2",null,{"children":"6. 题目六：据你的经验，为什么大厂都不怎么用 Etag？"}],"\n",["$","p",null,{"children":"很可能被分配到不同的服务器来相应，而根据 ETag 的计算原理，不同的服务器，有可能在资源内容没有变化的情况下，计算出不一样的 Etag，而使得缓存失效。\n而且 Etag 计算较为复杂，所以可能会使得服务端响应变慢。"}]]
