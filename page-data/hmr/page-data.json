{"componentChunkName":"component---src-templates-blog-post-js","path":"/hmr/","result":{"data":{"site":{"siteMetadata":{"title":"kunsun"}},"markdownRemark":{"html":"<ol>\n<li>不刷新浏览器</li>\n<li>不进行 IO 操作，放在内存中</li>\n<li>webpack 中配合 HotModuleReplacementPlugin 插件</li>\n</ol>\n<p>也可以用 webpack-dev-middleware，更加灵活</p>\n<p>参考文章：\n<a href=\"https://zhuanlan.zhihu.com/p/30669007\">https://zhuanlan.zhihu.com/p/30669007</a>\n<a href=\"https://juejin.im/post/5de0cfe46fb9a071665d3df0\">https://juejin.im/post/5de0cfe46fb9a071665d3df0</a></p>\n<h2>关键角色</h2>\n<ol>\n<li>webpack-dev-server:</li>\n<li>websocket:</li>\n<li>浏览器：</li>\n</ol>\n<h2>过程：</h2>\n<ol>\n<li>监听文件变化，打包文件</li>\n<li>webpack-dev-middleware 调用 webpack 暴露的 API 对代码变化进行监控，并且告诉 webpack，将代码打包到内存中</li>\n<li>webpack-dev-server 对文件变化的监控</li>\n<li>用 websocket 传递给浏览器一个更新后信息，包括的 hash 值</li>\n<li>浏览器再把信息传递给 server，server 决定刷新方式，如果是 hmr 不是 live reload,则往下走</li>\n<li>浏览器有个 runtime 文件，向 server 发送 hash，server 返回 json，包括所有要更新的模块</li>\n</ol>\n<h2>官方描述</h2>\n<h3>App 中</h3>\n<ol>\n<li>App 要求 HMR runtime 检查更新</li>\n<li>HMR runtime 异步下载更新，然后通知 App</li>\n<li>App 要求 HMR runtime 更新</li>\n<li>HMR runtime 同步地应用更新</li>\n</ol>\n<h3>在 compiler 中</h3>\n<p>除了普通资源，compiler 需要发出 \"update\"，将之前的版本更新到新的版本。\"update\" 由两部分组成：</p>\n<ol>\n<li>更新后的 manifest (JSON)\n<ol>\n<li>manifest 包括新的 compilation hash 和所有的 updated chunk 列表\n<ol>\n<li>每个 chunk 都包含着全部更新模块的最新代码</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>一个或多个 updated chunk (JavaScript)</li>\n</ol>\n<h2>原理分析</h2>\n<p>WDS：webpack-dev-server, 作为 server 端</p>\n<ol>\n<li>Webpack compile</li>\n<li>HMR server</li>\n<li>Bundle server</li>\n</ol>\n<p>Browser：浏览器端 bundle.js</p>\n<ol>\n<li>HMR Runtime</li>\n<li>your js code</li>\n</ol>\n<p>作用：</p>\n<ol>\n<li>webpack compile： 将 JS 编译成 Bundle</li>\n<li>HMR server：将热更新的文件传递给 HMR Runtime</li>\n<li>Bundle server: 提供文件在浏览器访问</li>\n<li>HMR Runtime：注入到浏览器，更新文件变化，通知给 HMR server</li>\n<li>bundle.js: 构建输出文件</li>\n</ol>","frontmatter":{"date":"February 02, 2021","path":"/hmr","title":"热更新 Hot Module Replacement"}}},"pageContext":{"id":"f27e1ca7-10e8-50a5-bbaa-7d7ff2b75a8d"}},"staticQueryHashes":[],"slicesMap":{}}